<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Adventure Planner</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="three-canvas"></div>
    <div class="container">
        <h1>Plan Your Space Adventure</h1>
        <form id="tripForm">
            <div class="form-group">
                <label for="destination">Choose your destination:</label>
                <select name="destination" id="destination">
                    <option value="Mars">Mars</option>
                    <option value="Moon">Moon</option>
                    <option value="Lunar Orbit">Lunar Orbit</option>
                    <option value="Mars Orbit">Mars Orbit</option>
                </select>
            </div>
            <div class="form-group">
                <label for="mission_type">Choose your mission type:</label>
                <select name="mission_type" id="mission_type">
                    <option value="Tourist">Tourist</option>
                    <option value="Scientist">Scientist</option>
                </select>
            </div>
            <div class="form-group">
                <label for="passengers">Number of Passengers:</label>
                <input type="number" id="passengers" min="1" max="10" value="1">
            </div>
            <button type="submit">Plan My Trip</button>
        </form>
        
        <div id="ticket-container" class="ticket-container">
            <canvas id="ticket-canvas" width="800" height="300"></canvas>
        </div>
        <div id="launch-button" class="launch-button"></div>
        <div id="animation-container"></div>
        
        <p class="disclaimer">This is a simulated space adventure for funâ€”actual space travel not included!</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script>
        let bookingData = {};

        // Three.js Background Setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('three-canvas').appendChild(renderer.domElement);

        const starGeometry = new THREE.BufferGeometry();
        const starMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.1 });
        const starVertices = [];
        for (let i = 0; i < 1000; i++) {
            const x = (Math.random() - 0.5) * 2000;
            const y = (Math.random() - 0.5) * 2000;
            const z = (Math.random() - 0.5) * 2000;
            starVertices.push(x, y, z);
        }
        starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
        const stars = new THREE.Points(starGeometry, starMaterial);
        scene.add(stars);

        const planetGeometry = new THREE.SphereGeometry(5, 32, 32);
        const planetMaterial = new THREE.MeshBasicMaterial({ color: 0xff4500 });
        const planet = new THREE.Mesh(planetGeometry, planetMaterial);
        planet.position.set(20, 0, -30);
        scene.add(planet);

        camera.position.z = 50;

        function animateBackground() {
            requestAnimationFrame(animateBackground);
            planet.rotation.y += 0.01;
            stars.rotation.y += 0.001;
            renderer.render(scene, camera);
        }
        animateBackground();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Form Submission
        document.getElementById('tripForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            bookingData.destination = document.getElementById('destination').value;
            bookingData.missionType = document.getElementById('mission_type').value;
            bookingData.passengers = document.getElementById('passengers').value;
            
            try {
                const response = await fetch('data.json');
                if (!response.ok) throw new Error('Failed to load data.json');
                const data = await response.json();
                const destData = data[bookingData.destination];
                
                const launchVehicle = destData.launch_vehicles[Math.floor(Math.random() * destData.launch_vehicles.length)];
                const launchYear = ["2028", "2029", "2030"][Math.floor(Math.random() * 3)];
                const transitTime = destData.transit_time[Math.floor(Math.random() * destData.transit_time.length)];
                const activities = destData.activities[bookingData.missionType].sort(() => 0.5 - Math.random()).slice(0, 2);
                
                // Draw Ticket with Background Image
                const canvas = document.getElementById('ticket-canvas');
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const bgImage = new Image();
                bgImage.src = bookingData.destination.includes("Mars") ? 'mars-bg.jpg' : 'moon-bg.jpg';
                bgImage.onload = function() {
                    ctx.globalAlpha = 0.3;
                    ctx.drawImage(bgImage, 0, 0, canvas.width, canvas.height);
                    ctx.globalAlpha = 1.0;
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = '#00bfff';
                    ctx.font = 'bold 40px Montserrat';
                    ctx.fillText(`Space Ticket: ${bookingData.destination}`, 50, 60);
                    ctx.font = '24px Montserrat';
                    ctx.fillStyle = '#ffffff';
                    ctx.fillText(`Mission: ${bookingData.missionType}`, 50, 100);
                    ctx.fillText(`Passengers: ${bookingData.passengers}`, 50, 140);
                    ctx.fillText(`Vehicle: ${launchVehicle}`, 50, 180);
                    ctx.fillText(`Launch: ${launchYear}`, 50, 220);
                    ctx.fillText(`Transit: ${transitTime}`, 50, 260);
                    ctx.fillText(`Activities: ${activities.join(', ')}`, 400, 100);
                };

                document.getElementById('launch-button').innerHTML = '<button onclick="launchAnimation()">Launch Simulation</button>';

                // Update planet color
                planetMaterial.color.set(bookingData.destination.includes("Mars") ? 0xff4500 : 0xaaaaaa);
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('ticket-container').innerHTML = '<p>Error loading trip details. Please try again!</p>';
            }
        });

        // Warp Speed Animation
        function launchAnimation() {
            const animationContainer = document.getElementById('animation-container');
            animationContainer.innerHTML = ''; 
            const animationRenderer = new THREE.WebGLRenderer({ alpha: true });
            animationRenderer.setSize(1000, 600);
            animationContainer.appendChild(animationRenderer.domElement);

            const animationScene = new THREE.Scene();
            const animationCamera = new THREE.PerspectiveCamera(75, 1000 / 600, 0.1, 1000);
            animationCamera.position.set(0, 0, 50);

            // Cockpit Frame
            const cockpitMaterial = new THREE.LineBasicMaterial({ color: 0x00ff00 });
            const cockpitPoints = [
                new THREE.Vector3(-20, -15, 0),
                new THREE.Vector3(20, -15, 0),
                new THREE.Vector3(20, 15, 0),
                new THREE.Vector3(-20, 15, 0),
                new THREE.Vector3(-20, -15, 0)
            ];
            const cockpitGeometry = new THREE.BufferGeometry().setFromPoints(cockpitPoints);
            const cockpit = new THREE.Line(cockpitGeometry, cockpitMaterial);
            animationScene.add(cockpit);

            // Warp Speed Stars
            const warpStarGeometry = new THREE.BufferGeometry();
            const warpStarMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.5 });
            const warpStarVertices = [];
            for (let i = 0; i < 100; i++) {
                const x = (Math.random() - 0.5) * 100;
                const y = (Math.random() - 0.5) * 100;
                const z = -Math.random() * 1000;
                warpStarVertices.push(x, y, z);
            }
            warpStarGeometry.setAttribute('position', new THREE.Float32BufferAttribute(warpStarVertices, 3));
            const warpStars = new THREE.Points(warpStarGeometry, warpStarMaterial);
            animationScene.add(warpStars);

            let speed = 0;
            function animateWarp() {
                requestAnimationFrame(animateWarp);
                speed += 0.1;
                const positions = warpStars.geometry.attributes.position.array;
                for (let i = 2; i < positions.length; i += 3) {
                    positions[i] += speed;
                    if (positions[i] > 0) positions[i] = -1000;
                }
                warpStars.geometry.attributes.position.needsUpdate = true;
                animationRenderer.render(animationScene, animationCamera);
            }
            animateWarp();
        }
    </script>
</body>
</html>
